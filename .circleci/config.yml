version: 2.1
orbs: {node: circleci/node@4.5.1, cypress: cypress-io/cypress@1.28.0, slack: circleci/slack@4.4.2, percy: percy/agent@0.1.3}
workflows:
  version: 2
  Scheduled-Smoke-Tests:
    jobs:
    - cypress/install
    - cypress/run:
        name: Scheduled Smoke Tests
        requires:
          - cypress/install
        record: true
        store_artifacts: true
        spec: cypress/integration/E2E/*
        command-prefix: npx percy exec --
        post-steps:
        - store_test_results: {path: test-results}
        - slack/notify: {channel: general, event: fail, template: basic_fail_1, mentions: '@Jack Munn'}
        - slack/notify: {channel: general, event: pass, template: basic_success_1, mentions: '@Jack Munn'}
    - percy/finalize_all:
        requires: [Scheduled Smoke Tests]
